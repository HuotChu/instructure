/**
 * Copyright (c) 2015 Scott Bishop
 * SquareDB - www.squaredb.com
 * MIT License (MIT) - This header must remain intact.
 **/
define("temple",[],function(){"use strict";var e=/\{\{([\w\-\.]*)\}\}/gim,t=/\{\{\+([\w\-\.]+)\}\}/gim,n=/<\s*(\w+)[^>]+data-template="([^"]+)"(?:[^\/]*>.*[\r\n\w\W]*?<\s*\/\s*\1\s*>|\s*\/\s*>)/gim,r={},i=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild},o=function(e,n){var r,i="",o=0,a=n.getAttribute("data-repeat-count"),u=n.getAttribute("data-repeat"),s=(e=e[u])?e.length||a:0,c=function(e,t){return this[t]};for(o;s>o;++o)r=e[o],i+=n.outerHTML.replace(t,c.bind(r));return i=i.replace(/\sdata-repeat="\w+"/gi,""),a&&(i=i.replace(/\sdata-repeat-count="\d+"/gi,"")),n.parentNode.innerHTML?n.parentNode.innerHTML=i:(n.parentNode.childNodes[0].innerHTML=i,n=n.parentNode.childNodes[0]),n},a=function(e){for(var t,n=e.attributes,r=0,i=n.length,o=[];i>r;++r)t=n[r],0===t.nodeName.indexOf("data-event-args-")&&o.push(t.value);return o},u=function(t){return l(t.template,!0).then(function(r){r.replace(n,function(e,n,r){e=e.replace(/\{\{\+/g,"{{"),e=e.replace(/\sdata-repeat="\w+"/gi,""),t.templates[r]=e.replace(/\sdata-template="[\w\-_]+"/gi,"")});var u,s,c,l,h,d,f,p,v,g,_,b,m=r.replace(e,function(e,n){for(var r=n.split("."),i=r.shift(),o=r.length,a=t.data,u=a?a[i]:"";o>0;)i=r.shift(),o=r.length,u=u[i];return u instanceof Function&&(u=u.call(a)),"undefined"!==u?u:""}),y=t.model,O=[];for(m=i(m),t.appendChild(m),m=t.firstChild,h=m.querySelectorAll("[data-repeat]"),0===h.length&&(h=m.getAttribute("data-repeat")?[m]:[]),u=0,s=h.length;s>u;++u)d=h[u],o(t.data,d);for(f=m.querySelectorAll("[data-index]"),u=0,s=f.length;s>u;++u)v=f[u],t.index[v.getAttribute("data-index")]=v;for(g=t.domEvents,u=0,s=g.length;s>u;++u)if(_=g[u],_.id)for(_.id=_.id.replace(/^_/,""),p=m.querySelectorAll("[data-index="+_.id+"]"),p.length||(p=m.querySelectorAll("[data-index^=_"+_.id+"]")),c=0,l=p.length;l>c;++c)v=p[c],v&&(b={},b.args=a(v),b.event=_.event,b.context=_.context,b.callback=_.callback,O.push(b),v.addEventListener(b.event,function(){var e=this.handler,t=Array.from(e.args);return t.push(this.node),t.push(this.box),e.callback.apply(e.context||null,t)}.bind({handler:b,node:v,box:t})));else O.push(_);if(t.domEvents=Array.from(O),O=[],y.addListener){for(g=t.modelEvents,u=0,s=g.length;s>u;++u)if(_=g[u],_.id)for(_.id=_.id.replace(/^_/,""),p=m.querySelectorAll("[data-index="+_.id+"]"),p.length||(p=m.querySelectorAll("[data-index^=_"+_.id+"]")),c=0,l=p.length;l>c;++c)v=p[c],v&&(b={},b.args=a(v),b.event=_.event,b.context=_.context,b.callback=_.callback,O.push(b),y.addListener(b.event,function(e){var t=this.handler,n=Array.from(t.args);return n.push(e),n.push(this.node),n.push(this.box),t.callback.apply(t.context||null,n)}.bind({handler:b,node:v,box:t}),v));else O.push(_);t.modelEvents=Array.from(O)}return m.box=t,t.destination&&t.destination.appendChild(t),t})},s=function(e,t){r[e]=t},c=function(e){return r[e]},l=function(e,t){return e=decodeURI(e),new Promise(function(n,r){var i,o=new XMLHttpRequest,a=e.indexOf("?"),u=0>a?e.length:a,l=e.slice(0,u),h=l.replace(/\/|\./g,"");return-1!==e.indexOf("<")?void n(e):t&&(i=c(h))?void n(i):(o.open("GET",l),o.onload=function(){var e=o.response;e?(t&&s(h,e),n(e)):r(Error(o.statusText))},o.onerror=function(){r(Error("Network Error"))},void o.send())})};return{build:u}}),define("box",["temple"],function(e){"use strict";var t=function(n,r){var i=r||document.createDocumentFragment(),o=n.data||i.data||[],a=n.model||i.model||[],u=n.target||i.target||"",s=n.template||i.template||"",c=n.templates||i.templates,l=n.domEvents||i.domEvents,h=n.modelEvents||i.modelEvents;return i.data=o,i.model=a,i.destination=u,i.index=i.index||{},i.template=s,i.templates=c||{},i.domEvents=l||[],i.modelEvents=h||[],i.vanish=function(){},i.shed=function(){},i.build=function(n,r){var i=t(n,r);return e.build(i)},i.parse=function(t){return e.build(t||this).outerHTML},i};return function(n){var r=t(n);this.__proto__={view:e.build(r)},this.prototype||Object.defineProperty(this,"prototype",{enumerable:!1,configurable:!1,value:this.__proto__})}}),define("eventHub",[],function(){"use strict";var e=function(){return document.createElement("object")},t=function(e,t,r,i){return new CustomEvent(e,{cancelable:!!r,detail:i?n(t):t})},n=function(e){var t,n,r={__exposedProps__:{}};for(n in e)e.hasOwnProperty(n)&&(t=e[n],r[n]=t,r.__exposedProps__[n]=t);return r},r={},i={},o=function(e,n,r,i,o){var a=this.eventNode,u="",s=e.replace(/(\.\w{4,6})$/i,function(e,t){return u=t,""}),c=function(){a.dispatchEvent(t(s+u,n,i,o)),".read"!==u?a.dispatchEvent(t(s+".change",n,i,o)):a.dispatchEvent(t(s+".all",n,i,o))};if(n=n||{},n.origin=e,c(),r!==!1)for(;;){if(s=s.split("."),n.lastNode=s.pop(),!s.length)break;s=s.join("."),c()}return!0},a=function(e,t,n){var r,i=this.watchers,o=i[e];return n&&(t=t.bind(n)),o||(o=i[e]=[]),r=this.eventNode.addEventListener(e,t,!1),o.push(r),r},u=function(e){return this.eventNode.removeEventListener(e)},s=function(e){var t,n,r=e.event,i=this.watchers,o=i[r],a=0;if(r&&o){for(n=o.length;n>a;++a)t=o[a],this.removeListener(t);i[r]=null,delete i[r]}},c=function(t){var n,r=t.__proto__;return n=Object.create(r),Object.assign(n.__proto__,l),n.__proto__.eventNode=e(),n},l={connect:c,callBacks:i,watchers:r,dispatch:o,addListener:a,removeListener:u,garbageCollect:s};return l}),define("lobro",[],function(){"use strict";var e=window.localStorage,t=function(t){var n;try{n=JSON.stringify(t),n&&e.setItem(t._event,n)}catch(r){console.log(r)}},n=function(t){e.removeItem(t)},r=function(e,n){var r,i={version:n||1};Object.defineProperty(i,"_event",{enumerable:!1,value:e._event});for(r in e)e.hasOwnProperty(r)&&t(e[r]);t(i)},i=function(t){var n,r={},i=new RegExp("^"+t+"\\.[\\w\\-_\\.]+");r[t]={},r=r[t];for(n in e)e.hasOwnProperty(n)&&i.test(n)&&(r[n]=JSON.parse(e[n]));return this.restore?this.restore(r,t):r},o=function(e){var t,n=e.__proto__,r=function(){t.addListener(t._event+".change",function(e){var n=e.detail.origin,r=new RegExp("^"+t._event+"\\.([^\\.]+)","i"),i=n.match(r);i=i&&i[1],i&&"string"==typeof i&&/create|read|update|delete/.test(i)===!1&&t.putLocal(t[i])},t)},i="",o=new Promise(function(e){i=e});return t=Object.create(n),Object.assign(t.__proto__,c),t.__proto__.enableEvents=i,t.dispatch&&o.then(function(){r()}),t},a=function(t){var n=e.getItem(t);return n&&(n=JSON.parse(n)),n},u=function(){return e.clear(),e},s=function(e,t){var n=a(e);return n&&n.version===t},c={connect:o,isCurrent:s,clearLocal:u,getLocal:a,putLocal:t,persist:r,removeLocal:n,sync:i};return c}),define("request",[],function(){return function(e,t){return e=decodeURI(e),new Promise(function(n,r){var i=new XMLHttpRequest,o=e.indexOf("?"),a=0>o?e.length:o,u=e.slice(0,a),s=e.slice(a+1).split("&");i.open(t?"POST":"GET",u),t&&i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onload=function(){var e,t,o,a,u=0;if(i.response){if(s.length)for(i.uriArgs={},e=s.length,u;e>u;++u)a=s[u].split("="),t=a[0],o=a[1],i.uriArgs[t]=o;n(i)}else r(Error(i.statusText))},i.onerror=function(){r(Error("Network Error"))},i.send(t?s:null)})}}),define("util",[],function(){"use strict";String.prototype.trim=function(){return this.replace(/^\s|\s$/g,"")},function(){var e=window.chrome,t=window.navigator.vendor,n=window.navigator.userAgent.indexOf("OPR")>-1,r=window.navigator.userAgent.indexOf("Edge")>-1;null!==e&&void 0!==e&&"Google Inc."===t&&0==n&&0==r||(Array.prototype.indexOf=function(e){var t=0,n=this.length;for(t;n>t;++t)if(this[t]===e)return t;return-1})}(),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t,n,r,i,o,a,u,s;if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(s=Object(e),t=1,n=arguments.length;n>t;++t)if(i=arguments[t],void 0!==i&&null!==i)for(i=Object(i),r=Object.keys(i),o=0,n=r.length;n>o;++o)a=r[o],u=Object.getOwnPropertyDescriptor(i,a),void 0!==u&&u.enumerable&&(s[a]=i[a]);return s}})}),define("comparator",[],function(){"use strict";return function(e,t,n){var r,i,o,a,u="string"==typeof n?n.indexOf("."):-1,s="string"==typeof n?n.lastIndexOf("."):-1,c=0!==u,l=n.length&&s!==n.length-1,h=0,d=e.length,f=[];for(("like"===t||"not like"===t)&&(c&&(n="^"+n),l&&(n+="$")),h;d>h;++h)if(i=e[h]){switch(t){case"==":r=i==n;break;case"===":r=i===n;break;case">":r=i>n;break;case"<":r=n>i;break;case">=":r=i>=n;break;case"<=":r=n>=i;break;case"!=":r=i!=n;break;case"!==":r=i!==n;break;case"like":a=new RegExp(n,"i"),r=a.test(i);break;case"not like":a=new RegExp(n,"i"),r=!a.test(i);break;default:r=!1}o=f.indexOf(h)>-1,r&&!o&&f.push(h)}return f}}),define("aggregates",["./comparator"],function(e){"use strict";return function(t,n,r){var i,o,a,u=t[r],s=[],c=u.length;for(i in t)t.hasOwnProperty(i)&&s.push(i);if(o=u.reduce(function(e,t){var r;return"min"===n?r=t>e?e:t:"max"===n?r=e>t?e:t:("sum"===n||"avg"===n)&&(r=e+t),r}),"avg"===n)o/=c;else if("count"===n)return o=c*s.length,t={QUERY_COUNT:[o]};return s.length>1&&(a=e(t[r],"===",o),s.forEach(function(e){e!==r&&(i=t[e],t[e]=i.filter(function(e,t){return-1!==a.indexOf(t)}))})),t[r]=[o],t}}),define("go",["./aggregates","./comparator"],function(e,t){"use strict";var n=function(n){var a,u,s,c,l,h,d,f,p,v,g,_,b,m,y,O,w,E,x=n,A=x.db,j=x.table,T=x.distinct,P=x.selects,q=x.where,I=P.length||1,L={},S={},k=function(){P=Object.keys(j),I=P.length,d=P[0]};for(v=0;I>v;++v)d=P[v],d=d.replace(/['"]/g,""),-1!==d.indexOf("(")&&(u=d.match(/^(\w+)\(([^\)]+)\)/),d=u[2],"*"===d&&k(),S[d]=u[1]),-1!==d.indexOf(" as ")&&(d=d.replace(/(^\w+)\sas\s\w+/,"$1")),"*"===d&&k(),f=j[d]||[],L[d]=f.filter(function(e){return null!==e}),s=j.indices();if(q){if(p=q.initial,y=q.or,b=q.and,s=t(j[p[0]],p[1],p[2]),y.length)for(v=0,I=y.length;I>v;++v)for(O=y[v],c=t(j[O[0]],O[1],O[2]),g=0,_=c.length;_>g;++g)w=c[g],-1===s.indexOf(w)&&s.push(w);if(b.length)for(v=0,I=b.length;I>v;++v)m=b[v],c=t(j[m[0]],m[1],m[2]),s=s.filter(function(e){return-1!==this.indexOf(e)}.bind(c));L=r(L,s)}T?(s=i(L[T]),l=r(L,s)):l=L;for(d in S)S.hasOwnProperty(d)&&(a=S[d],l=e(l,a,d));if(l=o(l),a&&(l=l[0]),A.dispatch)for(v=0,I=l.length;I>v;++v){h=l[v],w=s[v];for(E in h)h.hasOwnProperty(E)&&A.dispatch(j._event+"."+E+"."+w+".read",{value:h[E]})}return l},r=function(e,t){var n;for(n in e)e.hasOwnProperty(n)&&(e[n]=e[n].filter(function(e,n){return-1!==t.indexOf(n)}));return e},i=function(e){var t=[],n=[];return e.filter(function(e,r){return-1===t.indexOf(e)&&null!==e?(t.push(e),n.push(r),!0):void 0}),n},o=function(e){var t,n,r,i,o=[];for(t in e)if(e.hasOwnProperty(t))for(n=e[t],r=n.length,i=0;r>i;++i)o[i]||(o[i]={}),o[i][t]=n[i];return o};return n}),define("Select",["./go"],function(e){"use strict";var t=function(e){this.selects=e};t.prototype={db:void 0,distinct:!1,selects:[],table:void 0,where:void 0};var n=function(e,t,n,r){this._queryObject=e,e.where={initial:[t,n,r],and:[],or:[]}};n.prototype={and:function(e,t,n){return this._queryObject.where.and.push([e,t,n]),this},or:function(e,t,n){return this._queryObject.where.or.push([e,t,n]),this},go:function(){return e(this._queryObject)},GO:function(){return e(this._queryObject)}};var r=function(e,t,r){return new n(this._queryObject,e,t,r)},i=function(e,t){this._queryObject=e,this._table=e.db[t],e.table=this._table},o=function(e){return new i(this._queryObject,e)};i.prototype={_table:void 0,where:function(){return r.apply(this,arguments)},WHERE:function(){return r.apply(this,arguments)},go:function(){return e(this._queryObject)},GO:function(){return e(this._queryObject)}};var a=function(e){var n=this._queryObject.db;return this._queryObject=new t([e]),this._queryObject.distinct=e,this._queryObject.db=n,this},u=function(e,n){return this._queryObject=new t(n||"*"),this._queryObject.db=e,this};return u.prototype={_queryObject:{},from:function(){return o.apply(this,arguments)},FROM:function(){return o.apply(this,arguments)},distinct:function(){return a.apply(this,arguments)},DISTINCT:function(){return a.apply(this,arguments)}},u}),define("db",["util","comparator","Select"],function(e,t,n){"use strict";var r=function(e,t){return this.__proto__={_db:e,_event:e._event+"."+t,constructor:this,columns:function(){var e,t=[];for(e in this)this.hasOwnProperty(e)&&t.push(e);return t},count:function(){var e=this.indices().length,t=this._db;return t.dispatch&&t.dispatch(this._event+".count.read",{value:e}),e},indices:function(){var e,t,n,r=[],i=0;for(t in this)if(this.hasOwnProperty(t)){for(e=this[t],n=e.length;n>i;++i)null!==e[i]&&r.push(i);return r}return r},holes:function(){var e,t,n,r=[],i=0;for(t in this)if(this.hasOwnProperty(t)){for(e=this[t],n=e.length;n>i;++i)null===e[i]&&r.push(i);return r}return r}},this.prototype||Object.defineProperty(this,"prototype",{enumerable:!1,configurable:!1,value:this.__proto__}),this},i=function(e,t){return this.__proto__={_event:e&&t&&e._event+"."+t,_db:e&&e._db,_table:e,push:function(e){var t=this._db,n=Array.prototype.push.call(this,e);return t.dispatch&&(t.dispatch(this._event+".create",{value:e,index:this.length-1}),this._table.count()),n},insert:function(e,t){var n=this._db;this[t]=e,n.dispatch&&n.dispatch(this._event+"."+t+".update",{value:e,index:t})}},this.prototype||(Object.defineProperty(this,"prototype",{enumerable:!1,configurable:!1,value:this.__proto__}),this.prototype.__proto__=Array.prototype),this},o={},a=function(){var e=Array.from(arguments);return 1===e.length&&(e=e[0],-1!==e.indexOf(",")&&(e=e.split(",").map(function(e){return e.trim()})),e instanceof Array==!1&&(e=[e])),e},u=function(e,n,r,i){this.validIndices=t(e[n],r,i),this.AND=this.and=function(n,r,i){var o=t(e[n],r,i);return this.validIndices=this.validIndices.filter(function(e){return-1!==o.indexOf(e)}),this},this.OR=this.or=function(n,r,i){var o=[];return this.validIndices=this.validIndices.concat(t(e[n],r,i)),this.validIndices=this.validIndices.filter(function(e){return-1===o.indexOf(e)?(o.push(e),!0):void 0}),this}};o.__proto__={create:function(e){var t=new s(e);return this[e]=t,t},drop:function(e){return this[e]?(this[e]=null,delete this[e],!0):!1},get:function(e){return this[e]},show:function(){var e,t=[];for(e in this)this.hasOwnProperty(e)&&t.push(e);return t}};var s=function(e){return this.__proto__={_event:e,_tableCount:0,count:function(){var e=this._tableCount;return this.dispatch&&this.dispatch(this._event+".count.read",{value:e}),e},COUNT:function(){return this.count.call(this)},select:function(){var e=a.apply(null,arguments);return new n(this,e)},SELECT:function(){return this.select.apply(this,arguments)},createTable:function(e){var t=this,n=new r(t,e);return t[e]=n,t.dispatch&&t.dispatch(this._event+".create",{value:n}),++this._tableCount,this.count(),function(){var r=a.apply({},arguments);return r.length&&t.alterTable(e).add.apply({},arguments),n}},CREATE_TABLE:function(e){return this.createTable.call(this,e)},alterTable:function(e){var t=this[e];return{add:function(){var e,n,r=a.apply(null,arguments),o=0,u=r.length,s=t.indices(),c=t.holes(),l=0,h=s.length,d=t._db;for(o;u>o;++o){for(e=r[o],n=t[e]=new i(t,e),l=0;h>l;++l)n.insert(void 0,s[l]);for(h=c.length,l=0;h>l;++l)n.insert(null,c[l]);d.dispatch&&d.dispatch(t._event+".create",{value:n})}return t},ADD:function(){return this.add.apply(this,arguments)},drop:function(){var e,n,r=a.apply(null,arguments),i=0,o=t._db;for((0===r.length||"*"===r[0])&&(r=t.columns()),n=r.length;n>i;++i)e=r[i],t[e]=null,delete t[e],o.dispatch&&o.dispatch(t._event+".delete",{value:e});return t},DROP:function(){return this.drop.apply(this,arguments)},modify:function(){}}},ALTER_TABLE:function(e){return this.alterTable.call(this,e)},insertInto:function(e){var t=this[e];return function(){var e=a.apply({},arguments),n=function(){var r,i,o,a=Array.from(arguments),u=0,s=e.length;for(u;s>u;++u)i=e[u],o=a[u],r=t[i],r.push(o);for(i in t)t.hasOwnProperty(i)&&-1===e.indexOf(i)&&t[i].push(void 0);return n};return{values:n,VALUES:n}}},INSERT_INTO:function(e){return this.insertInto.call(this,e)},insertJsonInto:function(e){var t=this[e],n=this;return function(e){var r,i,o,a,u,s=0,c=e.length,l=t._event.substr(t._event.indexOf(".")+1),h=n.insertInto(l);for(s;c>s;++s){i=e[s],o=[],u=[];for(r in i)i.hasOwnProperty(r)&&(t[r]||n.alterTable(l).add(r),o.push(r),u.push(i[r]));a=h.apply(null,o),a.values.apply(null,u)}}},INSERT_JSON_INTO:function(e){this.insertJsonInto.call(this,e)},update:function(e){var t=this[e],n=t._db,r={},i=function(e,t){return r[e]=t,i};return i.WHERE=i.where=function(e,i,o){var a=new u(t,e,i,o);return a.GO=a.go=function(){var e,i,o,a=0,u=this.validIndices.length,s=".update";for(a;u>a;++a){e=this.validIndices[a];for(i in t)t.hasOwnProperty(i)&&r[i]&&(o=r[i],t[i][e]=o,n.dispatch&&(null===o&&(s=".delete"),n.dispatch(t._event+"."+i+s,{value:o,index:e})))}return!0},a},{set:i,SET:i}},UPDATE:function(e){return this.update.call(this,e)},"delete":function(){var e,t=a.apply({},arguments),n=this,r=function(r){return e=n[r],(0===t.length||"*"===t[0])&&(t=e.columns()),{where:o,WHERE:o,go:i,GO:i}},i=function(){var r,i,o,a,u=this.validIndices,s=0,c=t.length;for(void 0===u&&(u=e.indices()),r=u.length;r>s;++s)for(i=u[s],o=0;c>o;++o)a=e[t[o]],a.insert(null,i),n.dispatch&&(n.dispatch(a._event+"."+i+".delete",{value:null,index:i}),--e._tableCount,e.count());return!0},o=function(t,n,r){var o=new u(e,t,n,r);return o.GO=o.go=i.bind(o),o};return{from:r,FROM:r}},DELETE:function(){return this["delete"].apply(this,arguments)},createUnique:function(){for(var e,t,n=(new Date).getTime().toString().split(""),r=["a","b","c","d","e","f","g","h","i","j"],i=0,o=n.length,a=[];o>i;++i)e=n[i],t=r[e],i%2===0?(i%8===4&&(t=t.toUpperCase()),a.push(t)):a.push(e);return a=a.map(function(e){switch(e){case"0":return"O";case"1":return"I";case"2":return"R";case"3":return"E";case"4":return"F";case"5":return"S";case"6":return"b";case"7":return"L";case"8":return"B";case"9":return"q";default:return e}}),a.join("")},restore:function(e,t){var n,r,i,o,a,u,s,c="",l=new RegExp(t+"\\.(.+)");for(i in e)if(e.hasOwnProperty(i))for(c=i.match(l)[1],a=e[i],u=Object.keys(e[i]),this.createTable(c)(u),r=a[u[0]].length,o=this.insertInto(c)(u),n=0;r>n;++n)s=[],u.forEach(function(e){s.push(a[e][n])}),o.values.apply(this,s)}},this.prototype||Object.defineProperty(this,"prototype",{enumerable:!1,configurable:!1,value:this.__proto__}),this};return{createDB:o.create,CREATE_DATABASE:o.create,dropDB:o.drop,DROP_DATABASE:o.drop,use:o.get,USE:o.get,show:o.show,SHOW_DATABASES:o.show}});
